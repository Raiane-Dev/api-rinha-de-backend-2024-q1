## Docker compose for production

version: "3"
services:

  nginx:
    image : nginx:1.25.3
    depends_on:
      - app
      - app1
      - app2
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    ports:
      - 9999:9999
    restart: always
    deploy:
      resources:
        limits:
          cpus: "0.17"
          memory: "10MB"

  app: &app
    hostname: app
    image: raianedev/rinha_api:1.0
    ports:
      - 4000:80
    deploy:
      resources:
        limits:
          cpus: "0.6"
          memory: "200MB"

  app1: 
    <<: *app
    hostname: app1
    ports:
      - 4001:80

  app2: 
    <<: *app
    hostname: app2
    ports:
      - 4002:80

  sqlite3:
    container_name: sqlite3
    image: keinos/sqlite3:latest
    tty: true
    restart: always
    volumes:
      - ./database/:/data
    command: [ "sqlite3", ".open /data/rinha_api.sqlite" ]
    deploy:
      resources:
        limits:
          cpus: "0.13"
          memory: "140MB"
